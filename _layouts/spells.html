<!doctype html>
<html>
  <head>
    {% include head.html %}
    <!-- <link href="../assets/css/newstyle.css" rel="stylesheet"> -->

    <!-- Datatables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.12.0/datatables.min.css"/>
    <!-- Datatables JavaScript -->
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.12.0/datatables.min.js"></script>
    <!-- Papa Parse -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>

    <script type="text/javascript">
      // timeline
      // var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1prVAoIfRSMnyqJ3dTe-0jRRja8c3Gy-Be8hiP3VYn28/pub?output=csv';
      // spells
      var public_spreadsheet_url = 'https://docs.google.com/spreadsheets/d/1Lsmu72Ssq48d7Df2zqYDFUoHsdsOb7K1L_u1FshKJWc/pub?output=csv';

      function init() {
        Papa.parse(public_spreadsheet_url, {
          download: true,
          header: true,
          complete: newShowInfo
        })
      }


      window.addEventListener('DOMContentLoaded', init)

      function newShowInfo(results) {
        var tableContent = []
        var data = results.data

        document.getElementById("alert").innerHTML = "Imported " + data.length + " spells.";

        data.forEach((row) => {
          var txt = "";
          txt = txt + "<h4><a class=\"internal-link\" name=\"" + row['Name'].replace(/\s/g, '') + "\">" + row['Name'] + "</h4>";
          if (row['Level'] == "0") {
            txt = txt + "<i>Cantrip";
          } else {
            txt = txt + "<i>Level: " + row['Level'];
          }
          if (row['Ritual'] == "Yes") {
            txt = txt + " (ritual)";
          }
          txt = txt + "</i><br/>";
          txt = txt + "<b>Casting time: </b>" + row['Casting_Time'] + "<br/>";
          txt = txt + "<b>Target: </b>" + row['Target'] + "<br/>";
          txt = txt + "<b>Range: </b>" + row['Range'] + "<br/>";
          txt = txt + "<b>Components: </b>" + row['Components'] + "<br/>";
          txt = txt + "<b>Duration: </b>";
          if (row['Conc'] == "Yes") {
            txt = txt + "Concentration, up to " + row['Duration'] + "<br/><br/>";
          } else {
            txt = txt + row['Duration'] + "<br/><br/>";
          }
          txt = txt + "<p>" + row['Web_Description'] + "</p>";

          var weight = (row['Weight']) ? row['Weight'] : '-'
          var description = (row['Description']) ? row['Description'] : '-'
          tableContent.push([txt]);
        });

        var contentTable = $('#contentTable').DataTable({
          data: tableContent,
          order: [[0, 'desc']],
          ordering: false,
          lengthMenu: [[ 25, 50, 100, -1], [25, 50, 100, "All"]],
          iDisplayLength: -1,
          // aoColumnDefs: [{ sClass: "td-nobreak",
          //                   aTargets: [ 0 ] },
          //                 { sClass: "td-center",
          //                   aTargets: [ 1 ] }],
          columns: [{ title: '<h1>Spells</h1>'}],
                    // { title: 'Spell'},
                    // { title: 'Casting_Time'},
                    // { title: 'Components'},
                    // { title: 'Web_Description'}],
          dom:  "<'row'<'col-sm-12'f>>" +
                "<'row'<'col-sm-12'tr>>" //+
                // "<'row'<'col-sm-12'i>>"
        });

        // Create search box on each column
        // $('#contentTable thead tr').clone(true).appendTo( '#contentTable thead' );
        // $('#contentTable thead tr:eq(1) th').each( function (i) {
        //   var title = $(this).text();
        //   $(this).html( '<div class="input-group"><input type="text" class="form-control input-sm" placeholder="Search" /></div>' );

        //   $( 'input', this ).on( 'keyup change', function () {
        //     if ( contentTable.column(i).search() !== this.value ) {
        //       contentTable
        //         .column(i)
        //         .search( this.value )
        //         .draw();
        //     }
        //   });

        //   $( 'input', this ).on( 'click', function (e) {
        //     e.stopPropagation();
        //   });
        // });
      }
    </script>
  </head>

  <body>

    {% include navigation.html %}
    <div class="container container-main">

      <!-- <h3>Spells</h3> -->

        {{ content }}

        <p id="alert" style="font-style:italic;"></p>

        <table class="table table-striped table-hover table-condensed" id="contentTable"></table>

      </div>

  </body>
</html>
